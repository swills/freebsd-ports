# Created by: George Reid <greid@ukug.uk.freebsd.org>
# $FreeBSD$

PORTNAME=	dnrd
PORTVERSION=	2.20.4
PORTREVISION=	1
CATEGORIES=	dns

MAINTAINER=	ports@FreeBSD.org
COMMENT=	Proxy DNS daemon

LICENSE=	GPLv2+
LICENSE_FILE=	${WRKSRC}/COPYING

USES=		gmake autoreconf
USE_RC_SUBR=	${PORTNAME}
USE_GITHUB=     yes

GH_ACCOUNT=     benjaminpetrin

USERS=		dnrd
GROUPS=		dnrd

GNU_CONFIGURE=	yes

CPPFLAGS+=	-DNAMED_SEMAPHORE_NAME='\"/ports-dns-dnrd\"'

PORTDOCS=	AUTHORS COPYING ChangeLog INSTALL NEWS README
PORTEXAMPLES=	README-cache README-cygwin README-master TODO master.sample

OPTIONS_DEFINE=	TCP MASTER DEBUG RANDOM DOCS EXAMPLES CIDOMM
OPTIONS_DEFAULT=TCP MASTER RANDOM CIDOMM

TCP_DESC=	TCP support
MASTER_DESC=	Master file support
RANDOM_DESC=	Random source port
CIDOMM_DESC=	Match defined servers case insensitive (WinClients)

TCP_CONFIGURE_ENABLE=		tcp
MASTER_CONFIGURE_ENABLE=	master
DEBUG_CONFIGURE_ENABLE=		enable-debug
RANDOM_CONFIGURE_ENABLE=	random-src
CIDOMM_EXTRA_PATCHES=		${FILESDIR}/ci-s-match.diff

do-install:
	@${MKDIR} ${STAGEDIR}${ETCDIR}
	${INSTALL_PROGRAM} ${WRKSRC}/src/dnrd ${STAGEDIR}${PREFIX}/sbin/
	${INSTALL_MAN} ${WRKSRC}/doc/dnrd.8 ${STAGEDIR}${MAN8PREFIX}/man/man8/
	${INSTALL_DATA} ${WRKSRC}/doc/master.sample ${STAGEDIR}${ETCDIR}/

do-install-DOCS-on:
	@${MKDIR} ${STAGEDIR}${DOCSDIR}
	${INSTALL_DATA} ${PORTDOCS:S,^,${WRKSRC}/,} ${STAGEDIR}${DOCSDIR}/

do-install-EXAMPLES-on:
	@${MKDIR} ${STAGEDIR}${EXAMPLESDIR}
	${INSTALL_DATA} ${PORTEXAMPLES:S,^,${WRKSRC}/doc/,} ${STAGEDIR}${EXAMPLESDIR}/

.include <bsd.port.mk>
