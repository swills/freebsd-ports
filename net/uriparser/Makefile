# Created by: Ed Schouten <ed@FreeBSD.org>
# $FreeBSD$

PORTNAME=	uriparser
DISTVERSION=	0.9.4
CATEGORIES=	net
MASTER_SITES=	https://github.com/${PORTNAME}/${PORTNAME}/releases/download/${PORTNAME}-${PORTVERSION}/
DISTFILES=	${DISTNAME}${EXTRACT_SUFX}
EXTRACT_ONLY=	${DISTNAME}${EXTRACT_SUFX}

MAINTAINER=	svysh.fbsd@gmail.com
COMMENT=	URI parsing library

LICENSE=	BSD3CLAUSE
LICENSE_FILE=	${WRKSRC}/COPYING

BUILD_DEPENDS=	bash:shells/bash

USES=		pathfix cmake:noninja zip
USE_LDCONFIG=	yes

CMAKE_OFF=	URIPARSER_BUILD_DOCS # will fetch prebuilds from the upstream, if DOCS is selected
DISTDOCSNAME=	${DISTNAME}-doc
DISTDOCSFILE=	${DISTDOCSNAME}${EXTRACT_SUFX}

OPTIONS_DEFINE=		DOCS GTEST
DOCS_DISTFILES=		${DISTDOCSFILE} ${DISTNAME}.qch
DOCS_EXTRACT_ONLY=	${DISTDOCSFILE}
GTEST_DESC=		Before install, build and run googletests
GTEST_BUILD_DEPENDS=	googletest>=1.10.0:devel/googletest
GTEST_CMAKE_BOOL=	URIPARSER_BUILD_TESTS

PORTDOCS=	*

post-build-GTEST-on:
	@${ECHO} "### Running googletests, as requested... ###"
	@(cd ${BUILD_WRKSRC} && ${MAKE} test)
	@${ECHO} "### Googletests completed. ###"

post-install-DOCS-on:
	${MKDIR} ${STAGEDIR}${DOCSDIR}/qch
	cd ${WRKSRC}/doc && ${COPYTREE_SHARE} . ${STAGEDIR}${DOCSDIR}
	cd ${WRKSRC}/../${DISTDOCSNAME} && ${COPYTREE_SHARE} . ${STAGEDIR}${DOCSDIR}
	${INSTALL_MAN} ${DISTDIR}/${DISTNAME}.qch ${STAGEDIR}${DOCSDIR}/qch
	( ${ECHO} "QCH file is a QT Compressed Help file, generated by doxygen, cf:"; \
	${ECHO} "https://doc.qt.io/qt-5/assistant-details.html"; ) > ${STAGEDIR}${DOCSDIR}/qch/readme-qch

.include <bsd.port.mk>
